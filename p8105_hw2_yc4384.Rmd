---
title: "p8105_hw2_yc4384"
author: "Yangyang Chen"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(tools)
```

## Problem 1

**First:**

* Clean the data in `pols-month.csv`. 
* Use `separate()` to break up the variable `mon` into integer variables `year`, `month`, and `day`.
* Replace month number with month name 
* Create a `president` variable taking values `gop` and `dem`.
* Remove `prez_dem` and `prez_gop`; and remove the `day` variable.
```{r}
pols_df = 
  read_csv("data/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day")) |> 
  mutate(month = month.abb[as.numeric(month)]) |> 
  mutate(president  = gov_dem) |> 
  select(-c(prez_dem,prez_gop)) |> 
  select(-day) 
```

**Second:** 

* Clean the data in snp.csv using a similar process to the above.
* Arrange according to year and month.
* Organize so that `year` and `month` are the leading columns.
```{r}
snp_df = 
  read_csv("data/snp.csv") |> 
  janitor::clean_names() |> 
  mutate(date = mdy(date)) |> 
  separate(date, into = c("year", "month", "day")) |> 
  mutate(month = month.abb[as.numeric(month)]) |> 
  mutate(year = ifelse(as.numeric(year) >= 2050 & as.numeric(year)<= 2068, as.numeric(year) - 100, as.numeric(year))) |> 
  select(-day,) |> 
  mutate(year = as.character(year)) |> 
  relocate(year, month)
```

**Third:** 

* Tidy the unemployment data so that it can be merged with the previous datasets. 
* This process will involve switching from “wide” to “long” format.
* Ensuring that key variables have the same name.
* Ensuring that key variables take the same values.

```{r}
unemploy_df = 
  read_csv("data/unemployment.csv") |> 
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemploy_rate"
  ) |> 
  janitor::clean_names() |> 
  mutate(year = as.character(year)) |> 
  mutate(month = toTitleCase(month)) |> 
  relocate(year, month)
```

**Date Description:** 

* Join the datasets by merging snp into pols.
* Merging unemployment into the result.

```{r}
prob1_df = 
pols_df |>  
  left_join(snp_df, by = c("year", "month")) |> 
  left_join(unemploy_df, by = c("year", "month"))

```
* **`pols_df`** contains `r nrow(pols_df) - 1` observations and 'r ncol(pols_df)' variables, decribing the number of national politicians who are democratic or republican at any given time.

* **snp_df** contains `r nrow(snp_df) - 1` observations and 'r ncol(snp_df)' variables, describing Standard & Poor’s stock market index (S&P), often used as a representative measure of stock market as a whole.

* **unemploy_df** contains `r nrow(unemploy_df) - 1` observations and 'r ncol(unemploy_df)' variables, describing the percentage of unemployment in each month of the associated year.

* **prob1_df** is the `r dim(prob1_df)[1]` * `r dim(prob1_df)[2]` dimention result dataset, which contains  `r nrow(prob1_df) - 1` observations and `r ncol(prob1_df) - 1` variables. It ranges from `r range(prob1_df$year)[1]` to  `r range(prob1_df$year)[2]`. It's variable conbined all key variables in **`pols_df`**, **snp_df** and **unemploy_df** datasets. including `r colnames(prob1_df)`. 


## Problem 2
```{r}
library(readxl)
```

**Dataset_1 - Mr. Trash Wheel:**

* Specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in `read_excel`.

* Use reasonable variable names.

* Omit rows that do not include dumpster-specific data.

* Update the data to include a new `homes_powered` variable based on this calculation.

```{r}
trash_df = 
  read_excel("data/202207 Trash Wheel Collection Data.xlsx", range = "A2:N549") |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  mutate(homes_powered_new = weight_tons*500/30) 
```

Function to clean inconsistent date format:

```{r}
# clean_date =
#   function(date_string) {
#   # Try to parse as Date using various formats
#   date <- try(as.Date(date_string, format = "%Y/%m/%d"), silent = TRUE)
#   if (inherits(date, "Date")) {
#     return(date)
#   } else {
#     # Try other date formats
#     date <- try(as.Date(date_string, format = "%m/%d/%Y"), silent = TRUE)
#   if (inherits(date, "Date")) {
#       return(date)
#     } else {
#       # Add more format attempts as needed
#       return(NA)
#     }
#   }
# }
# 
# cleaned_data <- trash_df |>
#   mutate(cleaned_date = sapply(, clean_date))

```


**Dataset_2 - Professor Trash Wheel:**

* Import, clean, and organize the data for Professor Trash Wheel.

```{r}
prof_df = 
  read_excel("data/202207 Trash Wheel Collection Data.xlsx", sheet = 2, range = "A2:M94") |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  mutate(homes_powered_new = weight_tons*500/30) 
```

**Dataset_3 - Gwynnda Trash Wheel:**

* Import, clean, and organize the data for Gwynnda Trash Wheel.

```{r}
gwyn_df = 
  read_excel("data/202207 Trash Wheel Collection Data.xlsx", sheet = 4, range = "A2:K108") |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  mutate(homes_powered_new = weight_tons*500/30) 
```

**Tidy Three Datasets and Combination:**

Tidy:

```{r}
trash_df = 
  trash_df |> 
  mutate(dumpster = "Mr.Trash") |> # dumpster_Mr_Trash = c(1:nrow(trash_df)-1)
  select(-c(month, year, homes_powered)) |> 
  mutate(date = as.character(date)) |> 
  relocate(dumpster)
```

```{r}
prof_df =
  prof_df |> 
  mutate(dumpster = "Prof.Trash") |> 
  select(-c(month, year, homes_powered)) |> 
  mutate(date = as.character(date)) |> 
  relocate(dumpster)
```

```{r}
gwyn_df =
  gwyn_df |> 
  mutate(dumpster = "Gwynnda_Trash") |> 
  select(-c(month, year, homes_powered))|> 
  mutate(date = as.character(date)) |> 
  relocate(dumpster)
```

Combination:
```{r}
prob2_df = 
  trash_df |> 
  full_join(prof_df, by = c("dumpster","date","chip_bags","glass_bottles","grocery_bags", "weight_tons","volume_cubic_yards", "plastic_bottles", "polystyrene","cigarette_butts", "homes_powered_new")) |> 
  full_join(gwyn_df, by = c("dumpster","date", "weight_tons","volume_cubic_yards", "plastic_bottles", "polystyrene","cigarette_butts","homes_powered_new")) |> 
  mutate(date = as.Date(date, "%Y-%m-%d")) |> 
  arrange(date) |> 
  relocate(dumpster) 
```

**Data Description:**

* **prob2_df** contains  `r nrow(prob2_df)` observations and `r ncol(prob2_df)` variables. Its key variables are `r colnames(prob2_df)`. The total weight of trash collected by Professor Trash Wheel are `r sum(prof_df$homes_powered_new)`. The total number of cigarette butts collected by Gwynnda in July of 2021 is `r if(gwyn_df$date == filter(between(gwyn_df$date, as.Date('2021-07-01'), as.Date('2021-07-31')))){sum(cigarette_butts)}`
